# ST-007-02: Push Notification System to CLI Endpoints

**Parent Task**: MT-007 - Production Security and Real-Time Communication Framework  
**Duration**: 4 hours  
**Type**: Push Communication

## Overview
Implement push notification system that sends real-time updates to registered CLI endpoints running in REPL mode.

## Scope
- Create CLI endpoint registry system
- Implement push notification dispatcher
- Add health checking for CLI endpoints
- Create notification queuing and retry logic
- Setup notification event types and formatting
- Implement notification delivery tracking
- Add fallback mechanisms for failed deliveries

## Technical Requirements
- CLI endpoint registration and discovery
- HTTP client pool for push notifications
- Notification queue with retry and exponential backoff
- Health checking with automatic cleanup
- Event serialization and delivery tracking
- Delivery confirmation mechanism
- Circuit breaker for unreachable endpoints

## Acceptance Criteria
- [ ] CLI endpoints can register for push notifications
- [ ] Push notifications deliver within 100ms when CLI is available
- [ ] Health checking automatically cleans up unreachable CLIs
- [ ] Notification retry logic handles temporary failures
- [ ] Delivery tracking provides confirmation status
- [ ] Event formatting is consistent and parseable
- [ ] Fallback to WebSocket works when push fails
- [ ] System handles CLI registration/deregistration gracefully

## Files to Create/Modify
- `internal/push/notifier.go` - Push notification service
- `internal/push/registry.go` - CLI endpoint registry
- `internal/push/dispatcher.go` - Notification dispatcher
- `internal/push/health_checker.go` - CLI health monitoring
- `internal/push/queue.go` - Notification queue and retry
- `internal/api/handlers/cli_registry.go` - CLI registration endpoints

## Dependencies
- HTTP client pool
- Event queue system
- WebSocket server (ST-007-01) for fallback

## Testing Requirements
- Unit tests for notification dispatch logic
- Integration tests with mock CLI endpoints
- Delivery failure and retry testing
- Health checking validation
- Load testing with multiple CLI instances

## Success Metrics
- Push delivery success rate >99%
- Delivery latency <100ms
- Health check accuracy 100%
- Retry success rate >95%