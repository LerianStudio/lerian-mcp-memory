# ST-MT-001-001: Create Task Entity with Validation

## Status
- **Status:** ✅ COMPLETED
- **Completion Date:** 2025-01-09
- **Implementation:** Successfully implemented in `/Users/fredamaral/Repos/lerianstudio/lerian-mcp-memory/cli/internal/domain/entities/task.go`
- **Actual Implementation:** Fully implemented with enhanced business methods beyond the original specification
- **Deviations:** Enhanced with additional business logic methods like Start(), Complete(), Cancel(), Reset(), and comprehensive tag/time management
- **Next Steps:** None - implementation exceeds requirements

## 1. Sub-Task Overview
- **Sub-Task ID:** ST-MT-001-001
- **Sub-Task Name:** Create Task Entity with Validation
- **Parent Task:** MT-001: CLI Foundation with Local Storage and MCP Integration
- **Estimated Duration:** 3 hours
- **Implementation Type:** Code

## 2. Deliverable Specification
- **Primary Output:** Task entity struct with validation methods
- **Code Location:** `cli/internal/domain/entities/task.go`
- **Technical Requirements:** Go structs with validation tags, error handling, UUID generation
- **Interface Definition:** Task struct with validation methods, constructor functions, and JSON serialization

## 3. Implementation Details
- **Step-by-Step Approach:**
  1. Create `cli/internal/domain/entities/` directory structure
  2. Define Task struct with all required fields from PRD specification
  3. Add validation tags using go-playground/validator
  4. Implement Status and Priority enums with validation
  5. Add constructor functions with business rule validation
  6. Implement JSON marshaling/unmarshaling methods
  7. Add timestamp management functions
  8. Create validation error handling

- **Code Examples:**
  ```go
  type Status string
  type Priority string
  
  const (
      StatusPending     Status = "pending"
      StatusInProgress  Status = "in_progress"
      StatusCompleted   Status = "completed"
      StatusCancelled   Status = "cancelled"
  )
  
  const (
      PriorityLow    Priority = "low"
      PriorityMedium Priority = "medium"
      PriorityHigh   Priority = "high"
  )
  
  type Task struct {
      ID             string    `json:"id" validate:"required,uuid"`
      Content        string    `json:"content" validate:"required,min=1,max=1000"`
      Status         Status    `json:"status" validate:"required,oneof=pending in_progress completed cancelled"`
      Priority       Priority  `json:"priority" validate:"required,oneof=low medium high"`
      Repository     string    `json:"repository" validate:"required"`
      SessionID      string    `json:"session_id,omitempty"`
      CreatedAt      time.Time `json:"created_at"`
      UpdatedAt      time.Time `json:"updated_at"`
      CompletedAt    *time.Time `json:"completed_at,omitempty"`
      EstimatedMins  int       `json:"estimated_minutes,omitempty" validate:"gte=0"`
      ActualMins     int       `json:"actual_minutes,omitempty" validate:"gte=0"`
      Tags           []string  `json:"tags,omitempty"`
      ParentTaskID   string    `json:"parent_task_id,omitempty" validate:"omitempty,uuid"`
      AISuggested    bool      `json:"ai_suggested"`
  }
  
  func NewTask(content, repository string) (*Task, error) {
      task := &Task{
          ID:          uuid.New().String(),
          Content:     strings.TrimSpace(content),
          Status:      StatusPending,
          Priority:    PriorityMedium,
          Repository:  repository,
          CreatedAt:   time.Now(),
          UpdatedAt:   time.Now(),
          AISuggested: false,
      }
      
      if err := task.Validate(); err != nil {
          return nil, err
      }
      
      return task, nil
  }
  
  func (t *Task) Validate() error {
      validate := validator.New()
      return validate.Struct(t)
  }
  ```

- **Configuration Changes:** None required
- **Dependencies:** 
  - `github.com/go-playground/validator/v10`
  - `github.com/google/uuid`

## 4. Acceptance Criteria
- **Functional Criteria:**
  - Task struct contains all fields specified in PRD data model
  - Validation prevents creation of invalid tasks
  - Constructor function enforces business rules
  - Status transitions are properly validated
  - JSON serialization works correctly for all fields
  
- **Technical Criteria:**
  - Code follows Go conventions and project style
  - All public methods have proper documentation
  - Error messages are clear and actionable
  - Memory usage is optimized for task objects
  
- **Integration Criteria:**
  - Can be imported and used by domain services
  - Serialization is compatible with MCP tools format
  - Validation errors are properly structured
  
- **Test Criteria:**
  - All validation scenarios covered by unit tests
  - Edge cases for field validation tested
  - JSON serialization/deserialization tested

## 5. Testing Requirements
- **Unit Tests:**
  - Valid task creation succeeds with proper defaults
  - Invalid content (empty, too long) fails validation
  - Invalid status/priority values fail validation
  - Invalid repository format fails validation
  - UUID validation for ID and parent task ID
  - Timestamp generation and updates work correctly
  - JSON marshaling preserves all data accurately
  - Validation error messages are user-friendly

- **Integration Tests:** None required (pure domain entity)
- **Manual Testing:** Verify task entity usage in CLI commands
- **Test Data:** Create comprehensive test fixtures for valid/invalid task scenarios

## 6. Definition of Done
- **Code Complete:** Task entity fully implemented with all validation rules
- **Tests Passing:** All unit tests written and passing (≥90% coverage)
- **Documentation Updated:** Godoc comments on all public methods and types
- **Integration Verified:** Can be instantiated and used by TaskService
- **Review Approved:** Code review completed by team lead

## 7. Dependencies and Blockers
- **Required Sub-Tasks:** None (foundational task)
- **External Dependencies:** Go validation and UUID libraries
- **Environmental Requirements:** Go 1.23+ development environment
- **Potential Blockers:** Validation library compatibility or performance issues

## 8. Integration Notes
- **Component Interfaces:** Used by TaskService in domain layer
- **Data Flow:** Created from CLI input, validated, then stored via Storage interface
- **Error Handling:** Returns structured validation errors for CLI display
- **Configuration Impact:** None - pure domain logic