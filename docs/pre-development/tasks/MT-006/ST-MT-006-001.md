# ST-006-01: HTTP API Layer Foundation with Chi Router

**Parent Task**: MT-006 - Server-Side AI Integration and HTTP API Foundation  
**Duration**: 3 hours  
**Type**: Infrastructure Foundation

## Overview
Implement the foundational HTTP API layer using Chi router with comprehensive middleware stack for CLI communication and future API endpoints.

## Scope
- Create HTTP API layer with Chi router (`/api/v1/*` endpoints)
- Implement core middleware stack (logging, CORS, recovery)
- Add version compatibility checking middleware
- Setup request/response handling infrastructure
- Create health check endpoint
- Implement API error handling and standardization
- Add request validation framework

## Technical Requirements
- Chi router with proper route grouping
- Middleware chain with logging, CORS, panic recovery
- Version checking middleware for CLI compatibility
- Standardized error response format
- Request/response JSON serialization
- Health check endpoint (`GET /api/v1/health`)
- Request timeout handling
- Proper HTTP status code usage

## Acceptance Criteria
- [ ] Chi router is properly configured with middleware stack
- [ ] Version compatibility checking blocks incompatible CLI versions
- [ ] Health check endpoint returns proper system status
- [ ] Error responses follow consistent JSON format
- [ ] Request/response logging captures important information
- [ ] CORS is configured for development and production
- [ ] Panic recovery prevents server crashes
- [ ] Request timeouts are properly handled

## Files to Create/Modify
- `internal/api/router.go` - Main router configuration
- `internal/api/middleware/version.go` - Version checking
- `internal/api/middleware/logging.go` - Request logging
- `internal/api/middleware/cors.go` - CORS configuration
- `internal/api/handlers/health.go` - Health check handler
- `internal/api/response/error.go` - Error response formatting
- `cmd/server/main.go` - HTTP server integration

## Dependencies
- Chi router library
- Existing MCP server foundation
- Configuration management

## Testing Requirements
- Unit tests for middleware functionality
- Integration tests for router configuration
- Health check endpoint testing
- Error handling validation
- Version compatibility testing

## Success Metrics
- API response time <50ms for health checks
- Version checking accuracy 100%
- Error response consistency 100%
- Middleware overhead <10ms